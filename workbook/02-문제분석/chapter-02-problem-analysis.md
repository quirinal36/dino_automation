# 챕터 2: 문제 분석

> "문제를 정확히 이해하면 해결책은 자연스럽게 따라온다"

---

## 학습 목표

- Chrome Dino 게임의 시각적 요소를 분석한다
- ROI(Region of Interest)의 개념을 이해한다
- Calibration(캘리브레이션)이 왜 필요한지 이해한다
- 장애물 감지 전략을 수립한다

---

## 게임 분석하기

### 게임 실행

1. Chrome을 열고 `chrome://dino`에 접속하세요
2. 스페이스바를 눌러 게임을 시작하세요
3. 몇 번 플레이하면서 관찰하세요

### 관찰할 것들

게임을 플레이하면서 다음을 관찰하세요:

1. **배경색은 무엇인가요?**
2. **장애물(선인장, 새)의 색은 무엇인가요?**
3. **장애물은 어디서 나타나나요?**
4. **공룡은 화면 어디에 있나요?**

### 핵심 발견

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│    점수: 00000                                    ☁        │
│                                                            │
│                                                            │
│                          🌵                                │
│    🦖                    🌵🌵          🌵                  │
│ ═══════════════════════════════════════════════════════════│
│                                                            │
└────────────────────────────────────────────────────────────┘
     ↑                      ↑
   공룡                  장애물 출현 영역
  (고정 위치)
```

**발견 1**: 배경은 **흰색** (밝음)
**발견 2**: 장애물은 **검은색/회색** (어두움)
**발견 3**: 장애물은 **오른쪽에서 왼쪽**으로 다가옴
**발견 4**: 공룡은 **화면 왼쪽**에 고정되어 있음

---

## ROI (Region of Interest) 란?

### 정의

**ROI = 관심 영역**

전체 화면 중에서 우리가 "관심을 가지고 지켜볼" 특정 사각형 영역입니다.

### 왜 ROI가 필요한가?

전체 화면 vs ROI 비교:

| 구분 | 전체 화면 (1920x1080) | ROI (90x50) |
|------|---------------------|-------------|
| 분석할 픽셀 수 | 2,073,600개 | 4,500개 |
| 처리 속도 | 느림 | **460배 빠름** |
| 정확도 | 노이즈 많음 | 정확함 |

### ROI의 위치

```
┌─────────────────────────────────────────────────┐
│                                                 │
│                                                 │
│                     ┌──────┐                    │
│    🦖               │ ROI  │  ← 장애물을 먼저   │
│ ═══════════════════ │      │    감지하는 영역   │
│                     └──────┘                    │
└─────────────────────────────────────────────────┘
```

**ROI 위치 결정 원칙:**
- 공룡 앞쪽 (오른쪽)
- 지면 높이 (장애물이 나타나는 곳)
- 너무 멀면: 너무 일찍 점프
- 너무 가까우면: 반응 시간 부족

---

## Calibration (캘리브레이션) 이란?

### 정의

**Calibration = 보정/설정**

각 사용자의 화면 환경에 맞게 ROI 좌표를 설정하는 과정입니다.

### 왜 Calibration이 필요한가?

같은 프로그램이라도 환경마다 다릅니다:

| 환경 요소 | 사용자 A | 사용자 B |
|----------|---------|---------|
| 화면 해상도 | 1920x1080 | 2560x1440 |
| 브라우저 위치 | 왼쪽 상단 | 화면 중앙 |
| 브라우저 크기 | 전체 화면 | 창 모드 |
| 확대 수준 | 100% | 125% |

**결론**: ROI 좌표를 하드코딩할 수 없음! 각 사용자가 직접 설정해야 함.

### Calibration 과정

```
1. 사용자가 게임 화면을 띄운다
2. Calibration 도구를 실행한다
3. 마우스로 ROI 영역을 드래그해서 선택한다
4. 좌표가 설정 파일에 저장된다
5. 메인 프로그램이 이 좌표를 사용한다
```

---

## 장애물 감지 전략

### 색상 대비 활용

게임의 핵심 특징:
- 배경: **흰색** (RGB: 255, 255, 255에 가까움)
- 장애물: **어두운 색** (RGB: 0-100 정도)

### 감지 알고리즘 (개념)

```
1. ROI 영역의 이미지를 가져온다
2. 흑백(그레이스케일)으로 변환한다
3. "어두운 픽셀"의 비율을 계산한다
4. 비율이 일정 값(예: 5%)을 넘으면 → 장애물 있음!
```

### 시각적 예시

**장애물 없음:**
```
┌──────────────────┐
│                  │  모든 픽셀이 밝음 (흰색)
│                  │  어두운 픽셀 비율: 0%
│                  │
└──────────────────┘
```

**장애물 있음:**
```
┌──────────────────┐
│      ▓▓▓         │  일부 픽셀이 어두움
│      ▓▓▓▓        │  어두운 픽셀 비율: 15%
│      ▓▓▓▓▓       │  → 장애물 감지!
└──────────────────┘
```

---

## 생각해보기

### 질문 1: ROI 크기는 어떻게 정해야 할까?

- **너무 작으면**: 장애물의 일부만 보임, 감지 실패 가능
- **너무 크면**: 불필요한 영역 포함, 오탐지 가능

적당한 크기는 어떻게 결정할까요?

### 질문 2: 어두운 픽셀의 기준은?

픽셀 밝기는 0(검정)에서 255(흰색)까지입니다.

- 128 미만을 "어두움"으로 정하면?
- 50 미만을 "어두움"으로 정하면?

어떤 값이 적당할까요?

### 질문 3: 게임의 야간 모드는?

Dino 게임은 점수가 높아지면 야간 모드로 바뀝니다:
- 배경: 검은색
- 장애물: 흰색

이 경우 우리 알고리즘은 어떻게 될까요? 어떻게 해결할 수 있을까요?

---

## 실습

### Exercise 2.1: 게임 관찰

Chrome Dino 게임을 실행하고 다음을 기록하세요:

1. 게임 화면의 대략적인 위치 (왼쪽 상단 좌표)
2. 장애물이 나타나는 영역의 대략적인 위치
3. 선인장이 처음 보이는 순간부터 공룡에 닿을 때까지 대략 몇 초?

### Exercise 2.2: ROI 그리기

게임 스크린샷을 찍고, 그림 프로그램(그림판 등)에서:

1. 장애물을 감지할 ROI 영역을 사각형으로 표시
2. 왜 그 위치와 크기를 선택했는지 메모

### Exercise 2.3: 감지 알고리즘 설계

다음 의사코드(pseudocode)를 완성하세요:

```
함수 장애물_있는가(이미지):
    1. 이미지를 ______으로 변환
    2. 밝기가 _____ 미만인 픽셀 개수를 센다
    3. 전체 픽셀 대비 비율을 계산한다
    4. 비율이 _____% 이상이면:
        return True (장애물 있음)
    5. 아니면:
        return False (장애물 없음)
```

---

## 핵심 정리

### ROI (Region of Interest)

| 항목 | 설명 |
|------|------|
| 정의 | 분석할 화면의 특정 사각형 영역 |
| 목적 | 처리 속도 향상, 정확도 향상 |
| 표현 | 4개의 좌표: (x1, y1, x2, y2) |

### Calibration (캘리브레이션)

| 항목 | 설명 |
|------|------|
| 정의 | 사용자 환경에 맞게 ROI를 설정하는 과정 |
| 필요성 | 화면 크기, 브라우저 위치가 사용자마다 다름 |
| 결과물 | roi_config.json 파일 |

### 감지 전략

```
밝은 배경 + 어두운 장애물 = 어두운 픽셀 비율로 감지
```

---

## 체크포인트

- [ ] ROI가 무엇인지 설명할 수 있다
- [ ] 왜 ROI를 사용하면 좋은지 설명할 수 있다
- [ ] Calibration이 왜 필요한지 설명할 수 있다
- [ ] 장애물 감지 알고리즘의 기본 원리를 설명할 수 있다

---

## 다음 챕터 미리보기

**챕터 3: 화면 캡처**에서는 Pillow 라이브러리를 사용해서 실제로 화면을 캡처하는 방법을 배웁니다. 봇의 "눈"을 만드는 첫 번째 단계입니다.

[다음 챕터로 이동 →](../03-화면캡처/chapter-03-screen-capture.md)
