# ì±•í„° 5: ê´€ì‹¬ ì˜ì—­ (ROI)

> "ì „ì²´ë¥¼ ë³´ì§€ ë§ê³ , í•„ìš”í•œ ê³³ë§Œ ë´ë¼"

---

## í•™ìŠµ ëª©í‘œ

- ROI(Region of Interest) ê°œë…ì„ ì½”ë“œë¡œ êµ¬í˜„í•œë‹¤
- NumPy ë°°ì—´ ìŠ¬ë¼ì´ì‹±ì„ ì´í•´í•œë‹¤
- ì´ë¯¸ì§€ì—ì„œ íŠ¹ì • ì˜ì—­ì„ ì¶”ì¶œí•œë‹¤
- ROI ì¢Œí‘œ ì²´ê³„ë¥¼ ë§ˆìŠ¤í„°í•œë‹¤

---

## ROI ë³µìŠµ

ì±•í„° 2ì—ì„œ ë°°ìš´ ë‚´ìš©:

- **ROI** = ê´€ì‹¬ ì˜ì—­ (Region of Interest)
- ì „ì²´ í™”ë©´ ëŒ€ì‹  **íŠ¹ì • ì‚¬ê°í˜• ì˜ì—­**ë§Œ ë¶„ì„
- **ì¥ì **: ë¹ ë¥¸ ì²˜ë¦¬, ë†’ì€ ì •í™•ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    ğŸ¦–              â”‚  ROI  â”‚            â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚       â”‚â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ROI ì¢Œí‘œ í‘œí˜„

### 4ê°œì˜ ì¢Œí‘œ

ROIëŠ” **4ê°œì˜ ìˆ«ì**ë¡œ ì •ì˜ë©ë‹ˆë‹¤:

```
(x1, y1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â”‚        ROI          â”‚
    â”‚                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (x2, y2)
```

- **(x1, y1)**: ì™¼ìª½ ìœ„ ê¼­ì§“ì 
- **(x2, y2)**: ì˜¤ë¥¸ìª½ ì•„ë˜ ê¼­ì§“ì 

### í¬ê¸° ê³„ì‚°

- **ë„ˆë¹„ (width)** = x2 - x1
- **ë†’ì´ (height)** = y2 - y1

ì˜ˆì‹œ:
```
x1=100, y1=200, x2=300, y2=400

ë„ˆë¹„ = 300 - 100 = 200
ë†’ì´ = 400 - 200 = 200
```

---

## NumPy ë°°ì—´ ìŠ¬ë¼ì´ì‹±

### ê¸°ë³¸ ë¬¸ë²•

```python
array[ì‹œì‘:ë]  # 1ì°¨ì›
array[ì‹œì‘:ë, ì‹œì‘:ë]  # 2ì°¨ì›
```

**ì¤‘ìš”**: `ë` ì¸ë±ìŠ¤ëŠ” **í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**!

### ì˜ˆì‹œ

```python
arr = [0, 1, 2, 3, 4, 5]
arr[1:4]  # [1, 2, 3] - ì¸ë±ìŠ¤ 4ëŠ” í¬í•¨ ì•ˆ ë¨
```

### ì´ë¯¸ì§€ ìŠ¬ë¼ì´ì‹±

```python
# ì´ë¯¸ì§€ ë°°ì—´ ìŠ¬ë¼ì´ì‹±
roi = img_array[y1:y2, x1:x2]
```

**ì£¼ì˜**: ìˆœì„œê°€ `[y:y, x:x]`ì…ë‹ˆë‹¤!

---

## ROI ì¶”ì¶œ êµ¬í˜„

### ê¸°ë³¸ íŒ¨í„´

```python
# ROI ì¢Œí‘œ ì •ì˜
x1, y1 = 100, 200  # ì™¼ìª½ ìœ„
x2, y2 = 300, 400  # ì˜¤ë¥¸ìª½ ì•„ë˜

# ROI ì¶”ì¶œ (yê°€ ë¨¼ì €!)
roi = img_array[____:____, ____:____]
```

### ì¢Œí‘œ ìˆœì„œ ì •ë¦¬

| ê°œë… | í‘œí˜„ | ì˜ˆì‹œ |
|------|------|------|
| ì¢Œí‘œ ì •ì˜ | (x, y) | (100, 200) |
| ë°°ì—´ ì ‘ê·¼ | [y, x] | array[200, 100] |
| ìŠ¬ë¼ì´ì‹± | [y1:y2, x1:x2] | array[200:400, 100:300] |

**ê¸°ì–µë²•**: "ì¢Œí‘œëŠ” X-Y, ë°°ì—´ì€ Y-X"

---

## ì‹œê°ì  ì´í•´

```
ì „ì²´ ì´ë¯¸ì§€ (1920x1080):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (0,0)                                               â”‚
â”‚                                                     â”‚
â”‚         (x1,y1)â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                â”‚              â”‚                     â”‚
â”‚                â”‚     ROI      â”‚                     â”‚
â”‚                â”‚              â”‚                     â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜(x2,y2)              â”‚
â”‚                                                     â”‚
â”‚                                             (1919,1079)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì½”ë“œ:
roi = img_array[y1:y2, x1:x2]

ê²°ê³¼ ROIì˜ shape:
(y2-y1, x2-x1, 3)
```

---

## ìƒê°í•´ë³´ê¸°

### ì§ˆë¬¸ 1: ìŠ¬ë¼ì´ì‹± ê²°ê³¼

```python
img_array.shape  # (1080, 1920, 3)
roi = img_array[100:200, 300:500]
```

`roi.shape`ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?

### ì§ˆë¬¸ 2: ì˜ëª»ëœ ì¢Œí‘œ

ë§Œì•½ x1 > x2 ë˜ëŠ” y1 > y2 ì´ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?

```python
roi = img_array[200:100, 300:500]  # y1 > y2
```

### ì§ˆë¬¸ 3: ROI ìœ„ì¹˜ ì„ ì •

Dino ê²Œì„ì—ì„œ ROIëŠ” ì–´ë””ì— ìœ„ì¹˜í•´ì•¼ í• ê¹Œìš”?
- ê³µë£¡ë³´ë‹¤ ì™¼ìª½? ì˜¤ë¥¸ìª½?
- ì§€ë©´ ìœ„? ì•„ë˜? ì¤‘ê°„?

---

## ì‹¤ìŠµ ê³¼ì œ

### Exercise 5.1: ê¸°ë³¸ ìŠ¬ë¼ì´ì‹±

í™”ë©´ì˜ ì™¼ìª½ ìœ„ ì‚¬ë¶„ë©´ì„ ì¶”ì¶œí•˜ì„¸ìš”.

**íŒŒì¼ëª…**: `roi_test.py`

```python
import numpy as np
from PIL import ImageGrab, Image

# 1. í™”ë©´ ìº¡ì²˜
screenshot = ImageGrab.grab()
img_array = np.array(screenshot)

# 2. ì „ì²´ í¬ê¸° í™•ì¸
height, width, _ = img_array.______
print(f"ì „ì²´ í¬ê¸°: {width}x{height}")

# 3. ì™¼ìª½ ìœ„ ì‚¬ë¶„ë©´ ì¶”ì¶œ
half_w = width // 2
half_h = height // 2
roi = img_array[______:______, ______:______]

# 4. ROI í¬ê¸° í™•ì¸
print(f"ROI í¬ê¸°: {roi.shape}")

# 5. ROI ì €ì¥
roi_image = Image.fromarray(roi)
roi_image.save("roi_quarter.png")
print("ROI ì €ì¥ ì™„ë£Œ!")
```

### Exercise 5.2: ì •í™•í•œ ì¢Œí‘œë¡œ ROI ì¶”ì¶œ

íŠ¹ì • ì¢Œí‘œë¡œ ROIë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.

```python
# ROI ì¢Œí‘œ (ì§ì ‘ ê°’ ì…ë ¥)
x1, y1 = 100, 200
x2, y2 = 400, 350

# ROI ì¶”ì¶œ
roi = img_array[______:______, ______:______]

# ì˜ˆìƒ í¬ê¸° vs ì‹¤ì œ í¬ê¸°
expected_height = ______
expected_width = ______
actual_height, actual_width, _ = roi.shape

print(f"ì˜ˆìƒ í¬ê¸°: {expected_width}x{expected_height}")
print(f"ì‹¤ì œ í¬ê¸°: {actual_width}x{actual_height}")
```

### Exercise 5.3: ROI ì¶”ì¶œ í•¨ìˆ˜

ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”.

```python
def extract_roi(img_array, x1, y1, x2, y2):
    """
    ì´ë¯¸ì§€ ë°°ì—´ì—ì„œ ROIë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

    Args:
        img_array: NumPy ì´ë¯¸ì§€ ë°°ì—´
        x1, y1: ì™¼ìª½ ìœ„ ì¢Œí‘œ
        x2, y2: ì˜¤ë¥¸ìª½ ì•„ë˜ ì¢Œí‘œ

    Returns:
        ROI ì˜ì—­ì˜ NumPy ë°°ì—´
    """
    # ì¢Œí‘œ ì •ê·œí™” (x1 < x2, y1 < y2 ë³´ì¥)
    x1, x2 = min(x1, x2), max(x1, x2)
    y1, y2 = min(y1, y2), max(y1, y2)

    return img_array[______:______, ______:______]

# í…ŒìŠ¤íŠ¸
roi = extract_roi(img_array, 100, 200, 400, 350)
print(f"ì¶”ì¶œëœ ROI shape: {roi.shape}")
```

### Exercise 5.4: í™”ë©´ ì¤‘ì•™ ROI

í™”ë©´ ì •ì¤‘ì•™ì— 200x100 í¬ê¸°ì˜ ROIë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.

```python
# í™”ë©´ í¬ê¸°
height, width, _ = img_array.shape

# ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚°
center_x = ______
center_y = ______

# ROI í¬ê¸°
roi_width = 200
roi_height = 100

# ROI ì¢Œí‘œ ê³„ì‚° (ì¤‘ì•™ ê¸°ì¤€)
x1 = center_x - roi_width // 2
x2 = center_x + roi_width // 2
y1 = center_y - roi_height // 2
y2 = ______

# ROI ì¶”ì¶œ
roi = img_array[______:______, ______:______]
print(f"ì¤‘ì•™ ROI shape: {roi.shape}")  # (100, 200, 3) ì´ì–´ì•¼ í•¨
```

### Exercise 5.5: Dino ê²Œì„ìš© ROI í…ŒìŠ¤íŠ¸

Chrome Dino ê²Œì„ì„ ì—´ê³ , ì¥ì• ë¬¼ ê°ì§€ ì˜ì—­ì„ ì¶”ì¶œí•´ë³´ì„¸ìš”.

```python
import time

print("3ì´ˆ í›„ì— ìº¡ì²˜í•©ë‹ˆë‹¤. Dino ê²Œì„ í™”ë©´ì„ ì¤€ë¹„í•˜ì„¸ìš”!")
time.sleep(3)

# ìº¡ì²˜
screenshot = ImageGrab.grab()
img_array = np.array(screenshot)

# ROI ì¢Œí‘œ (ë³¸ì¸ í™”ë©´ì— ë§ê²Œ ì¡°ì •!)
# ëŒ€ëµì ì¸ ê°’ìœ¼ë¡œ ì‹œì‘í•´ì„œ ì¡°ì •í•˜ì„¸ìš”
x1 = 400  # ì¡°ì • í•„ìš”
y1 = 300  # ì¡°ì • í•„ìš”
x2 = 550  # ì¡°ì • í•„ìš”
y2 = 380  # ì¡°ì • í•„ìš”

# ROI ì¶”ì¶œ
roi = img_array[y1:y2, x1:x2]

# ì €ì¥í•´ì„œ í™•ì¸
roi_image = Image.fromarray(roi)
roi_image.save("dino_roi_test.png")
print(f"ROI ì €ì¥ë¨: {roi.shape}")
print("dino_roi_test.png íŒŒì¼ì„ ì—´ì–´ì„œ ì˜ì—­ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”!")
```

---

## ì˜ˆìƒ ê²°ê³¼

### Exercise 5.1 ì‹¤í–‰ ê²°ê³¼

```
ì „ì²´ í¬ê¸°: 1920x1080
ROI í¬ê¸°: (540, 960, 3)
ROI ì €ì¥ ì™„ë£Œ!
```

### Exercise 5.2 ì‹¤í–‰ ê²°ê³¼

```
ì˜ˆìƒ í¬ê¸°: 300x150
ì‹¤ì œ í¬ê¸°: 300x150
```

---

## í•µì‹¬ ì •ë¦¬

### ROI ì¢Œí‘œ

```
(x1, y1) = ì™¼ìª½ ìœ„
(x2, y2) = ì˜¤ë¥¸ìª½ ì•„ë˜
```

### ìŠ¬ë¼ì´ì‹± ë¬¸ë²•

```python
roi = img_array[y1:y2, x1:x2]
#               â†‘       â†‘
#               Y ë²”ìœ„   X ë²”ìœ„
```

### ê²°ê³¼ í¬ê¸°

```
roi.shape = (y2-y1, x2-x1, channels)
          = (height, width, 3)
```

### ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜

| ì‹¤ìˆ˜ | ì˜¬ë°”ë¥¸ ì½”ë“œ |
|------|-------------|
| `array[x:, y:]` | `array[y:, x:]` |
| `array[x1:x2, y1:y2]` | `array[y1:y2, x1:x2]` |
| ë ì¸ë±ìŠ¤ í¬í•¨ ê¸°ëŒ€ | ë ì¸ë±ìŠ¤ëŠ” ì œì™¸ë¨ |

---

## ì²´í¬í¬ì¸íŠ¸

- [ ] ë°°ì—´ ìŠ¬ë¼ì´ì‹± ë¬¸ë²•ì„ ì´í•´í•œë‹¤
- [ ] ROI ì¢Œí‘œë¡œ ì˜ì—­ì„ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤
- [ ] x, y ìˆœì„œì™€ y, x ìˆœì„œë¥¼ êµ¬ë¶„í•œë‹¤
- [ ] ì¶”ì¶œí•œ ROIë¥¼ ì´ë¯¸ì§€ë¡œ ì €ì¥í•  ìˆ˜ ìˆë‹¤
- [ ] Dino ê²Œì„ì—ì„œ ëŒ€ëµì ì¸ ROI ìœ„ì¹˜ë¥¼ íŒŒì•…í–ˆë‹¤

---

## ë‹¤ìŒ ì±•í„° ë¯¸ë¦¬ë³´ê¸°

**ì±•í„° 6: ì´ë¯¸ì§€ ì²˜ë¦¬**ì—ì„œëŠ” OpenCVë¥¼ ì‚¬ìš©í•´ì„œ ì»¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì´ê²ƒì€ ì¥ì• ë¬¼ ê°ì§€ë¥¼ ìœ„í•œ ë°ê¸° ë¶„ì„ì˜ ì²« ë‹¨ê³„ì…ë‹ˆë‹¤.

[ë‹¤ìŒ ì±•í„°ë¡œ ì´ë™ â†’](../06-ì´ë¯¸ì§€ì²˜ë¦¬/chapter-06-opencv-basics.md)
